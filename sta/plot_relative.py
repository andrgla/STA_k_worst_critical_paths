import matplotlib.pyplot as plt
import numpy as np

# Raw graph sizes
nodes_edges = {
    "Test_circuit_bar.v":      (3471, 6672),
    "Test_circuit_adder.v":    (1276, 2040),
    "Test_circuit_priority.v": (1106, 1956),
    "Test_circuit_sqrt.v":     (24746, 49236),
    "Test_circuit_ctrl.v":     (12, 14)
}

# Runtimes (seconds) for k = 1, 2, 3
runtimes = {
    "Test_circuit_bar.v": {
        1:0.024825, 2:0.043373, 3:0.076345, 4:0.079724, 5:0.109959,
        6:None, 7:0.145876, 8:0.165094, 9:0.182285, 10:0.200526,
        11:0.244064, 12:0.237624, 13:0.268869, 14:0.272834, 15:0.333725,
        16:0.332158, 17:0.345988, 18:0.346834, 19:0.380015, 20:0.398690,
        21:0.418006, 22:0.436614, 23:0.454757, 24:0.489300, 25:0.470222,
        26:0.541909, 27:0.518557, 28:0.568440, 29:0.567066, 30:0.574714,
        31:0.621019, 32:0.619299, 33:0.639774, 34:0.660590, 35:0.703762,
        36:0.691021, 37:0.730545, 38:0.733855, 39:0.768136, 40:0.765344,
        41:0.820584, 42:0.808535, 43:0.853879, 44:0.847993, 45:0.867805,
        46:0.882191, 47:0.927602, 48:0.913068, 49:0.961832
    },
    "Test_circuit_adder.v": {
        1:0.009009, 2:0.014719, 3:0.021488, 4:0.037793, 5:0.033331,
        6:None, 7:0.045972, 8:0.051760, 9:0.068129, 10:0.063864,
        11:0.071766, 12:0.087104, 13:0.083042, 14:0.098592, 15:0.096026,
        16:0.110650, 17:0.117717, 18:0.116750, 19:0.131471, 20:0.135584,
        21:0.132878, 22:0.148360, 23:0.154766, 24:0.161297, 25:0.167676,
        26:0.164236, 27:0.180085, 28:0.185505, 29:0.192190, 30:0.199569,
        31:0.204949, 32:0.216958, 33:0.218559, 34:0.366551, 35:0.231042,
        36:0.236213, 37:0.242681, 38:0.260548, 39:0.256379, 40:0.263186,
        41:0.267476, 42:0.285398, 43:0.281795, 44:0.299347, 45:0.292372,
        46:0.301680, 47:0.297486, 48:0.301556, 49:0.322169
    },

    "Test_circuit_priority.v": {
        1:0.007897, 2:0.014097, 3:0.019237, 4:0.028462, 5:0.043941,
        6:None, 7:0.039228, 8:0.044683, 9:0.049365, 10:0.064760,
        11:0.058657, 12:0.063237, 13:0.078637, 14:0.072630, 15:0.077265,
        16:0.086997, 17:0.077104, 18:0.088047, 19:0.077980, 20:0.089398,
        21:0.077451, 22:0.087842, 23:0.077420, 24:0.077253, 25:0.088141,
        26:0.076956, 27:0.087195, 28:0.077012, 29:0.087998, 30:0.077368,
        31:0.077227, 32:0.088403, 33:0.077127, 34:0.087803, 35:0.078430,
        36:0.088624, 37:0.077250, 38:0.077144, 39:0.088105, 40:0.077170,
        41:0.087402, 42:0.077391, 43:0.088925, 44:0.077122, 45:0.077835,
        46:0.088160, 47:0.077145, 48:0.088044, 49:0.077657
    },

    "Test_circuit_sqrt.v": {
        1:0.240415, 2:0.440939, 3:0.583499, 4:0.596299, 5:0.564578,
        6:None, 7:0.569532, 8:0.609664, 9:0.571710, 10:0.612343,
        11:0.617144, 12:0.598033, 13:0.598695, 14:0.629430, 15:0.584855,
        16:0.632165, 17:0.628886, 18:0.592731, 19:0.752179, 20:0.629669,
        21:0.590032, 22:0.625018, 23:0.631809, 24:0.594411, 25:0.594091,
        26:0.626481, 27:0.585834, 28:0.626981, 29:0.627621, 30:0.597904,
        31:0.587595, 32:0.629389, 33:0.585342, 34:0.623671, 35:0.634941,
        36:0.625712, 37:0.589621, 38:0.626464, 39:0.593034, 40:0.629113,
        41:0.932341, 42:0.614092, 43:0.589836, 44:0.661566, 45:0.598097,
        46:0.624595, 47:0.627791, 48:0.621197, 49:0.601447
    },

    "Test_circuit_ctrl.v": {
        1:0.000128, 2:0.000221, 3:0.000221, 4:0.000265, 5:0.000258,
        6:None, 7:0.000253, 8:0.000252, 9:0.000252, 10:0.000250,
        11:0.000293, 12:0.000254, 13:0.000250, 14:0.000252, 15:0.000251,
        16:0.000251, 17:0.000249, 18:0.000244, 19:0.000247, 20:0.000249,
        21:0.000249, 22:0.000290, 23:0.000313, 24:0.000264, 25:0.000258,
        26:0.000255, 27:0.000256, 28:0.000261, 29:0.000255, 30:0.000253,
        31:0.000252, 32:0.000250, 33:0.000249, 34:0.000250, 35:0.000287,
        36:0.000252, 37:0.000251, 38:0.000249, 39:0.000249, 40:0.000249,
        41:0.000295, 42:0.000265, 43:0.000256, 44:0.000252, 45:0.000257,
        46:0.000251, 47:0.000301, 48:0.000263, 49:0.000253
    }
}

ks = list(range(1, 50, 1))

plt.figure()

# Find k values that are valid (not None) for all benchmarks
valid_ks = [k for k in ks if all(runtimes[bench].get(k) is not None for bench in nodes_edges.keys())]

normalized_curves = []  # collect values for mean

for bench, (nodes, edges) in nodes_edges.items():
    # Compute normalized values only for valid k values
    norm_vals = [runtimes[bench][k] / ((nodes + edges) * k) for k in valid_ks]
    normalized_curves.append(norm_vals)
    plt.plot(valid_ks, norm_vals, marker="o", label=bench)

# Compute mean curve
mean_curve = np.mean(normalized_curves, axis=0)

# Plot the mean curve with thicker line
plt.plot(valid_ks, mean_curve, linewidth=3, marker="o", color="black", label="Mean")

plt.xlabel("k (number of critical paths)")
plt.ylabel("Runtime / (nodes + edges) [s per graph element]")
plt.title("Normalized runtime for k = 1-50 across benchmarks")
plt.legend()
plt.grid(True)
plt.tight_layout()
plt.show()